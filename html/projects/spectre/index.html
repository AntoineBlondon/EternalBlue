<!DOCTYPE html>
<html>
<head>
    <title>Spectre</title>
    <link rel="stylesheet" href="../../css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <header>
        <div class="navbar">
            <a href="./">home</a>
            <a href="./projects">projects</a>
            <a href="./about">about</a>
        </div>
    </header>
    <h1>Spectre</h1>
    
  <canvas id="spectrogram"></canvas>

  <script>
    const canvas = document.getElementById('spectrogram');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = 256;

    let audioContext, analyser, dataArray;

    async function setupAudio() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(stream);

      analyser = audioContext.createAnalyser();
      analyser.fftSize = 512;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);

      source.connect(analyser);

      draw();
    }

    function draw() {
      requestAnimationFrame(draw);

      analyser.getByteFrequencyData(dataArray);

      // Shift canvas left by 1 pixel
      const imageData = ctx.getImageData(1, 0, canvas.width - 1, canvas.height);
      ctx.putImageData(imageData, 0, 0);

      // Draw new data as vertical line on the right
      for (let i = 0; i < dataArray.length; i++) {
        const value = dataArray[i];
        const r = value;
        const g = value;
        const b = 255 - value;

        ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
        ctx.fillRect(canvas.width - 1, canvas.height - i, 1, 1);
      }
    }

    setupAudio();
  </script>
</body>
</html>
